{"version":3,"file":"authRole.middleware.js","sourceRoot":"","sources":["../../../../src/api/common/middleware/authRole.middleware.ts"],"names":[],"mappings":";;;;;;AACA,kFAAyD;AACzD,yDAAqD;AAErD,mBAAmB;AACZ,MAAM,kBAAkB,GAAG,CAAC,KAAa,EAAE,EAAE;IAClD,OAAO,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;QACzD,IAAI,CAAC;YACH,kBAAkB;YAClB,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC;YAExC,oBAAoB;YACpB,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,MAAM,IAAI,wBAAa,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;YAC5C,CAAC;YAED,oBAAoB;YACpB,MAAM,UAAU,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;YAC7C,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAExB,oBAAoB;YACpB,MAAM,OAAO,GAAG,wBAAU,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC;YAEzD,oBAAoB;YACpB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;gBAClC,MAAM,IAAI,wBAAa,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;YAC5C,CAAC;YAED,GAAG,CAAC,KAAK,GAAG;gBACV,EAAE,EAAE,OAAO,CAAC,EAAE;gBACd,IAAI,EAAE,OAAO,CAAC,IAAI;aACnB,CAAC;YAEF,IAAI,EAAE,CAAC;QACT,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,IAAI,CACF,IAAI,wBAAa,CAAC,KAAK,CAAC,UAAU,IAAI,GAAG,EAAE,SAAS,KAAK,CAAC,OAAO,EAAE,CAAC,CACrE,CAAC;QACJ,CAAC;IACH,CAAC,CAAC;AACJ,CAAC,CAAC;AAnCW,QAAA,kBAAkB,sBAmC7B","sourcesContent":["import { NextFunction, Request, Response } from \"express\";\nimport HttpException from \"../exceptions/http.exception\";\nimport { JwtService } from \"../services/jwt.service\";\n\n/** 인증 & 인가 미들웨어 */\nexport const authRoleMiddleware = (roles: role[]) => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    try {\n      // 헤더에서 토큰을 가져옵니다.\n      const token = req.headers.authorization;\n\n      // 토큰이 없으면 에러를 던집니다.\n      if (!token) {\n        throw new HttpException(401, \"토큰이 없습니다.\");\n      }\n\n      // 토큰에서 페이로드를 가져옵니다.\n      const tokenValue = token.split(\"Bearer \")[1];\n      console.log(tokenValue);\n\n      // 페이로드에서 역할을 확인합니다.\n      const payload = JwtService.verifyAccessToken(tokenValue);\n\n      // 역할이 없으면 에러를 던집니다.\n      if (!roles.includes(payload.role)) {\n        throw new HttpException(403, \"권한이 없습니다.\");\n      }\n\n      req.admin = {\n        id: payload.id,\n        role: payload.role,\n      };\n\n      next();\n    } catch (error: any) {\n      next(\n        new HttpException(error.statusCode ?? 401, `인증 실패 ${error.message}`)\n      );\n    }\n  };\n};\n"]}